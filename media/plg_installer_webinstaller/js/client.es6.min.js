if(!window.jQuery)throw new Error("WebInstaller plugin requires jQuery");if(!Joomla)throw new Error("Joomla API is not properly initialised");((a,b,c,d)=>{'use strict';const e={view:"dashboard",id:0,ordering:"",list:0,options:c.getOptions("plg_installer_webinstaller",{})};let f;class g{initialise(){e.loaded=1;const a=b.getElementById("uploadform-web-cancel");a.addEventListener("click",()=>{b.getElementById("uploadform-web").classList.add("hidden"),e.list&&b.querySelector(".list-view")&&b.querySelector(".list-view").click()}),this.loadweb("".concat(e.options.base_url,"index.php?format=json&option=com_apps&view=dashboard")),this.clickforlinks()}loadweb(f){if(!f)return!1;const h=new RegExp(e.options.base_url),i=/^index.php/;if(!(h.test(f)||i.test(f)))return a.open(f,"_blank"),!1;let j="".concat(f,"&product=").concat(e.options.product,"&release=").concat(e.options.release,"&dev_level=").concat(e.options.dev_level,"&list=").concat(e.list?"list":"grid","&lang=").concat(e.options.language);return""!==e.ordering&&b.getElementById("com-apps-ordering").value&&(e.ordering=b.getElementById("com-apps-ordering").value,j+="&ordering=".concat(e.ordering)),g.showLoadingLayer(),d.ajax({url:j,dataType:"json",cache:!0,timeout:2e4,success:a=>{b.getElementById("web-loader")&&b.getElementById("web-loader").classList.add("hidden");const c=b.getElementById("jed-container");c.innerHTML=a.data.html,b.getElementById("com-apps-searchbox").addEventListener("keypress",a=>{13===a.which&&this.initiateSearch()}),b.getElementById("search-extensions").addEventListener("click",()=>{this.initiateSearch()}),b.getElementById("search-reset").addEventListener("click",()=>{const a=b.getElementById("com-apps-searchbox");a.value="",this.initiateSearch()});const d=b.getElementById("com-apps-ordering");d&&d.addEventListener("change",()=>{const a=d.selectedIndex;e.ordering=d.options[a].value,this.installfromwebajaxsubmit()}),""!==e.options.installfrom_url&&g.installfromweb(e.options.installfrom_url)},fail:()=>{b.getElementById("web-loader")&&(b.getElementById("web-loader").classList.add("hidden"),b.getElementById("web-loader-error").classList.remove("hidden"))},complete:()=>{const d=b.getElementById("joomlaapsinstallatinput");if(d&&(d.value=e.options.installat_url),this.clickforlinks(),g.clicker(),"extension"!==e.view&&[].slice.call(b.querySelectorAll("div.load-extension")).forEach(a=>{a.addEventListener("click",b=>{b.preventDefault(),this.processLinkClick(a.getAttribute("data-url"))}),a.setAttribute("href","#")}),"extension"===e.view){const d=b.getElementById("install-extension"),e=b.getElementById("install-extension-from-external");d&&d.addEventListener("click",()=>{g.installfromweb(d.getAttribute("data-downloadurl"),d.getAttribute("data-name"))}),e&&e.addEventListener("click",()=>{const d=e.getAttribute("data-downloadurl"),f=a.confirm(c.JText._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",d));!0!==f||(b.getElementById("adminForm").setAttribute("action",d),b.querySelector("input[name=task]").setAttribute("disabled",!0),b.querySelector("input[name=install_directory]").setAttribute("disabled",!0),b.querySelector("input[name=install_url]").setAttribute("disabled",!0),b.querySelector("input[name=installtype]").setAttribute("disabled",!0),b.querySelector("input[name=filter_search]").setAttribute("disabled",!0),b.getElementById("adminForm").submit())})}e.list&&b.querySelector(".list-view")&&b.querySelector(".list-view").click(),g.hideLoadingLayer()},error:a=>{const c=b.getElementById("web-loader-error"),d=b.getElementById("web-loader");a.responseText&&c&&(c.innerHTML=a.responseText),d&&(d.classList.add("hidden"),c.classList.remove("hidden"))}}),!0}clickforlinks(){[].slice.call(b.querySelectorAll("a.transcode")).forEach(a=>{const b=a.getAttribute("href");a.addEventListener("click",a=>{a.preventDefault(),this.processLinkClick(b)}),a.setAttribute("href","#")})}initiateSearch(){e.view="dashboard",this.installfromwebajaxsubmit()}installfromwebajaxsubmit(){let a="&view=".concat(e.view);if(e.id&&(a+="&id=".concat(e.id)),b.getElementById("com-apps-searchbox").value){const c=encodeURI(b.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim());a+="&filter_search=".concat(c)}""!==e.ordering&&b.getElementById("com-apps-ordering").value&&(e.ordering=b.getElementById("com-apps-ordering").value),e.ordering&&(a+="&ordering=".concat(e.ordering)),this.loadweb("".concat(e.options.base_url,"index.php?format=json&option=com_apps").concat(a))}processLinkClick(a){const b=new RegExp(e.options.base_url),c=/^index.php/;b.test(a)||c.test(a)?(e.view=a.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===e.view?e.id=0:"category"===e.view&&(e.id=a.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(e.options.base_url+a)):this.loadweb(a)}static showLoadingLayer(){b.getElementById("web").appendChild(b.createElement("joomla-core-loader"))}static hideLoadingLayer(){const a=b.querySelector("#web joomla-core-loader");a.parentNode.removeChild(a)}static clicker(){b.querySelector(".grid-view")&&b.querySelector(".grid-view").addEventListener("click",()=>{e.list=0,b.querySelector(".list-container").classList.add("hidden"),b.querySelector(".grid-container").classList.remove("hidden"),b.getElementById("btn-list-view").classList.remove("active"),b.getElementById("btn-grid-view").classList.remove("active")}),b.querySelector(".list-view")&&b.querySelector(".list-view").addEventListener("click",()=>{e.list=1,b.querySelector(".grid-container").classList.add("hidden"),b.querySelector(".list-container").classList.remove("hidden"),b.getElementById("btn-grid-view").classList.remove("active"),b.getElementById("btn-list-view").classList.add("active")})}static installfromweb(a,d=null){if(!a)return alert(c.JText._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")),!1;const e=b.getElementById("install_url"),f=b.getElementById("uploadform-web-url");if(e.value=a,f.innerHTML=a,d){const a=b.getElementById("uploadform-web-name");a.innerHTML=d,b.getElementById("uploadform-web-name-label").classList.remove("hidden")}else b.getElementById("uploadform-web-name-label").classList.add("hidden");return b.getElementById("uploadform-web").classList.remove("hidden"),!0}}b.addEventListener("DOMContentLoaded",()=>{const a=()=>{const c=b.getElementById("myTab");if("UL"!==c.firstElementChild.tagName)return void setTimeout(a,50);const d=c.querySelector("#tab-web");d&&(e.options.installfromon&&d.click(),d.hasAttribute("active")&&!f&&(f=new g,f.initialise()),""!==e.options.installfrom_url&&d.click(),d.addEventListener("joomla.tab.shown",()=>{f||(f=new g,f.initialise())}))};setTimeout(a,50)})})(window,document,Joomla,window.jQuery);