(a=>{'use strict';var b=Math.round;const c=new RegExp(/^#([a-z0-9]{1,2})([a-z0-9]{1,2})([a-z0-9]{1,2})$/i),d=new RegExp(/^rgba?\(([0-9]+)[\D]+([0-9]+)[\D]+([0-9]+)(?:[\D]+([0-9](?:.\d+)?))?\)$/i),e=new RegExp(/^hsla?\(([0-9]+)[\D]+([0-9]+)[\D]+([0-9]+)[\D]+([0-9](?:.\d+)?)?\)$/i),f=new RegExp(/^(([0-1])|(0\\.[0-9]+)|([0-9]{1,2})|(100))$/),g=new RegExp(/^[0-9]{1,3}$/);class h{constructor(a){this.messageSpan=a.querySelector(".form-control-feedback"),this.mainInput=a.querySelector(".color-input"),this.input=a.querySelector("#slider-input"),this.sliders=a.querySelectorAll(".color-slider"),this.hueSlider=a.querySelector("#hue-slider"),this.saturationSlider=a.querySelector("#saturation-slider"),this.lightSlider=a.querySelector("#light-slider"),this.alphaSlider=a.querySelector("#alpha-slider"),this.color=a.dataset.color||"",this.default=a.dataset.default||"",this.format=this.input.dataset.format||"hex",this.saveFormat=this.mainInput.dataset.format||"hex",this.preview="true"===a.dataset.preview,this.setAlpha="hsla"===this.format||"rgba"===this.format,this.hue=360,this.saturation=1,this.light=1,this.alpha=1,this.defaultHsl=[this.hue,this.saturation,this.light,this.alpha],this.setInitValue(),this.setBackground(),this.preview?this.setInputPattern():this.input.style.display="none",this.mainInput.style.display="none",Array.prototype.forEach.call(this.sliders,a=>{a.addEventListener("change",()=>this.updateValue(a))}),this.input.addEventListener("change",()=>this.changeInput(this.input))}updateValue(a){this.showError("");const b=this.getSliderValueAsHsl(a.value,a.dataset.type),c=this.hslToRgb(b);[this.hue,this.saturation,this.light,this.alpha]=b,this.input.style.border="2px solid ".concat(this.getRgbString(c)),this.setSliderValues(b,a.dataset.type),this.setInputValue(b),this.setBackground(a)}changeInput(a){let b=[this.hue,this.saturation,this.light,this.alpha];if(!a.value)return this.mainInput.value="",void this.showError("");if(!this.checkValue(a.value))this.showError("JFIELD_COLOR_ERROR_WRONG_FORMAT"),this.setInputValue(this.defaultHsl);else{switch(this.showError(""),this.format){case"hue":b[0]=a.value,this.hue=a.value;break;case"saturation":b[1]=a.value,this.saturation=a.value;break;case"light":b[2]=a.value,this.light=a.value;break;case"alpha":b[3]=a.value,this.alpha=a.value;break;default:b=this.getHsl(a.value);}this.setSliderValues(b),this.setInputValue(b,!0)}}checkValue(a,b){const h=b||this.format;return"hue"===h?360>=a&&g.test(a):"saturation"===h||"light"===h||"alpha"===h?f.test(a):"hsl"===h||"hsla"===h?e.test(a):"hex"===h?c.test(a):!("rgb"!==h&&"rgba"!==h)&&d.test(a)}setInputPattern(){let a;switch(this.format){case"hue":a=g.source.slice(1,-1);break;case"saturation":case"light":case"alpha":a=f.source.slice(1,-1);break;case"hsl":case"hsla":a=e.source.slice(1,-1);break;case"rgb":a=d.source.slice(1,-1);break;case"hex":default:a=c.source.slice(1,-1);}this.input.setAttribute("pattern",a)}setBackground(a){Array.prototype.forEach.call(this.sliders,b=>{if(a===b)return;let c=[],d=100;if(c.push(this.getSliderValueAsRgb(0,b.dataset.type)),"hue"===b.dataset.type){d=360;for(let a=0;360>=a;a+=18)c.push(this.getSliderValueAsRgb(a,b.dataset.type))}else for(let a=0;100>=a;a+=10)c.push(this.getSliderValueAsRgb(a,b.dataset.type));c.push(this.getSliderValueAsRgb(d,b.dataset.type)),c=c.map(a=>this.getRgbString(a)),b.style.background="linear-gradient(90deg, ".concat(c.join(","),")"),b.style.webkitAppearance="none"})}setInitValue(){const a=window.getComputedStyle(this.input).getPropertyValue(this.default);if(this.default=a||this.default,""===this.color||"undefined"==typeof this.color)return this.input.value="",void(this.mainInput.value="");const b=this.checkValue(this.color,this.saveFormat)?this.color:this.default;if(!b)return void this.showError("JFIELD_COLOR_ERROR_NO_COLOUR");let c=[];/^[0-9]+$/.test(b)?(c=this.default&&this.getHsl(this.default),"hue"===this.format&&(c[0]=b),"saturation"===this.format&&(c[1]=1<b?b/100:b),"light"===this.format&&(c[2]=1<b?b/100:b),"alpha"===this.format&&(c[3]=1<b?b/100:b)):c=this.getHsl(b),[this.hue,this.saturation,this.light]=c,this.alpha=c[4]||this.alpha,this.defaultHsl=this.default?this.getHsl(this.default):c,this.setSliderValues(c),this.setInputValue(c),this.input.style.border="2px solid ".concat(this.getRgbString(this.hslToRgb(c)))}showError(a){this.messageSpan.innerText=a?Joomla.Text._(a):""}getHsl(a){let b=[];if(Array.isArray(a))b=a;else if(c.test(a))b=this.hexToHsl(a);else if(d.test(a))b=this.rgbToHsl(a);else if(e.test(a)){const c=a.match(e);b=[c[1],c[2],c[3],c[4]]}else return this.showError("JFIELD_COLOR_ERROR_CONVERT_HSL"),this.defaultHsl;let f;for(f=1;f<b.length;f+=1)b[f]=1<b[f]?b[f]/100:b[f];return b}getSliderValueAsHsl(b,c){let d=this.hue,e=this.saturation,f=this.light,g=this.alpha;switch(c){case"alpha":g=b;break;case"saturation":e=b;break;case"light":f=b;break;case"hue":default:d=b;}return 1<f&&(f/=100),1<e&&(e/=100),1<g&&(g/=100),[d,e,f,g]}getSliderValueAsRgb(a,b){return this.hslToRgb(this.getSliderValueAsHsl(a,b))}setSliderValues([c,d,e,f],a){this.hueSlider&&"hue"!==a&&(this.hueSlider.value=b(c)),this.saturationSlider&&"saturation"!==a&&(this.saturationSlider.value=b(100*d)),this.lightSlider&&"light"!==a&&(this.lightSlider.value=b(100*e)),f&&this.alphaSlider&&"alpha"!==a&&(this.alphaSlider.value=b(100*f))}setInputValue(a,c){const d=[this.mainInput];c||d.push(this.input),d.forEach(c=>{let d;switch(c.dataset.format){case"hsl":d=this.getHslString(a);break;case"hsla":d=this.getHslString(a,!0);break;case"rgb":d=this.getRgbString(this.hslToRgb(a));break;case"rgba":d=this.getRgbString(this.hslToRgb(a),!0);break;case"hex":d=this.rgbToHex(this.hslToRgb(a));break;case"alpha":d=b(100*a[3]);break;case"saturation":d=b(100*a[1]);break;case"light":d=b(100*a[2]);break;case"hue":default:d=b(a[0]);}c.value=d})}getRgbString([c,d,e,b],a){if(a||this.setAlpha){const a="undefined"==typeof b?this.alpha:b;return"rgba(".concat(c,", ").concat(d,", ").concat(e,", ").concat(a,")")}return"rgb(".concat(c,", ").concat(d,", ").concat(e,")")}getHslString(c,d){let[e,f,g,i]=c;return f*=100,g*=100,[e,f,g]=[e,f,g].map(a=>b(a)),d||this.setAlpha?(i=i||this.alpha,"hsla(".concat(e,", ").concat(f,"%, ").concat(g,"%, ").concat(i,")")):"hsl(".concat(e,", ").concat(f,"%, ").concat(g,"%)")}rgbToHex(a){let c=a[0].toString(16).toUpperCase(),d=a[1].toString(16).toUpperCase(),e=a[2].toString(16).toUpperCase();return c=1===c.length?"".concat(c).concat(c):c,d=1===d.length?"".concat(d).concat(d):d,e=1===e.length?"".concat(e).concat(e):e,"#".concat(c).concat(d).concat(e)}rgbToHsl(c){var e=Math.min;let f=c;if("string"==typeof c){const a=c.match(d);f=[a[1],a[2],a[3],a[4]]}const[i,j,g]=f.map(a=>1<a?a/255:a),b=Math.max(i,j,g),k=e(i,j,g),m=(b+k)/2,l=b-k;let n=0,o=0,p=f[3]||c[3]||this.alpha;if(b!==k)switch(o=0===b?b:1===k?k:(b-m)/e(m,1-m),b){case i:n=60*(j-g)/l;break;case j:n=60*(2+(g-i)/l);break;case g:default:n=60*(4+(i-j)/l);}return n=0>n?n+360:n,p=1<p?p/100:p,[n,o,m,p]}hexToHsl(a){const d=a.match(c),e=d[1],f=d[2],g=d[3],b=[parseInt(e,16),parseInt(f,16),parseInt(g,16)];return this.rgbToHsl(b)}hslToRgb([d,e,f,h]){var i=Math.abs;let j=1,k=1,m=1;const n=1<e?e/100:e,o=1<f?f/100:f,l=1<h?h/100:h;if(0>d||360<d||0>n||1<n||0>o||1<o)return this.showError("JFIELD_COLOR_ERROR_CONVERT_HSL"),this.hslToRgb(this.defaultHsl);const a=(1-i(2*o-1))*n,c=a*(1-i(d/60%2-1));if(0<=d&&60>d)[j,k,m]=[a,c,0];else if(60<=d&&120>d)[j,k,m]=[c,a,0];else if(120<=d&&180>d)[j,k,m]=[0,a,c];else if(180<=d&&240>d)[j,k,m]=[0,c,a];else if(240<=d&&300>d)[j,k,m]=[c,0,a];else if(300<=d&&360>=d)[j,k,m]=[a,0,c];else return this.showError("JFIELD_COLOR_ERROR_CONVERT_HUE"),this.hslToRgb(this.defaultHsl);const p=[j,k,m].map(c=>b(255*(c+(o-a/2))));return p.push(l),p}}a.addEventListener("DOMContentLoaded",()=>{const b=a.querySelectorAll(".color-slider-wrapper");b&&Array.prototype.forEach.call(b,a=>{new h(a)})})})(document);