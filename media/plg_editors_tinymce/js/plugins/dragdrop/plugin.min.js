tinymce.PluginManager.add("jdragdrop",function(a){tinyMCE.DOM.bind(document,"dragleave",function(a){return a.stopPropagation(),a.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="1px 0 0",!1});var b=function(b){var c=new FormData;c.append("Filedata",b),c.append("folder",tinyMCE.activeEditor.settings.mediaUploadPath);var d=new XMLHttpRequest;d.upload.onprogress=function(a){var b=100*(a.loaded/a.total);document.querySelector(".bar").style.width="".concat(b,"%")};var e=function(){setTimeout(function(){var b=document.querySelector("#jloader");b.parentNode.removeChild(b),a.contentAreaContainer.style.borderWidth="1px 0 0 0"},200)};d.onload=function(){var b=JSON.parse(d.responseText);if(200!==d.status)e();else if("0"===b.status&&(e(),a.windowManager.alert("".concat(b.message,": ").concat(tinyMCE.activeEditor.settings.setCustomDir).concat(b.location))),"1"===b.status){e();var c=tinyMCE.activeEditor.getDoc().createElement("img");c.src=tinyMCE.activeEditor.settings.setCustomDir+b.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,c.outerHTML)}},d.onerror=function(){e()},d.open("POST",tinyMCE.activeEditor.settings.uploadUri,!0),d.send(c)};"undefined"==typeof FormData?(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),a.on("drop",function(a){return a.preventDefault(),!1})):(a.on("dragenter",function(a){return a.stopPropagation(),!1}),a.on("dragover",function(b){return b.preventDefault(),a.contentAreaContainer.style.borderStyle="dashed",a.contentAreaContainer.style.borderWidth="5px",!1}),a.on("drop",function(c){if(c.dataTransfer&&c.dataTransfer.files&&0<c.dataTransfer.files.length){var d=[].slice.call(c.dataTransfer.files);d.forEach(function(a){if(a.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)){var d=document.createElement("div");d.id="jloader";var e=document.createElement("div");e.classList.add("progress"),e.classList.add("progress-success"),e.classList.add("progress-striped"),e.classList.add("active"),e.style.width="100%",e.style.height="30px";var f=document.createElement("div");f.classList.add("bar"),f.style.width="0",e.appendChild(f),d.appendChild(e),document.querySelector(".mce-toolbar-grp").appendChild(d),b(a)}c.preventDefault()})}a.contentAreaContainer.style.borderWidth="1px 0 0"}))});